<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Gynae Hospital - Test List</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; color: #005f99; }
    h2 { color: #333; margin-top: 30px; }
    .category { margin-bottom: 20px; }
    .test { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; }
    .hidden { display: none; }
    #selectedTests { margin-top: 20px; }
    #selectedTests ul { list-style-type: none; padding: 0; }
    #selectedTests li { background: #f1f1f1; margin: 5px 0; padding: 5px; border-radius: 5px; }
    #controls { margin-top: 20px; }
    button { padding: 10px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; }
    button.print { background-color: #0077b6; color: white; }
    button.pdf { background-color: #d62828; color: white; }
    #patientInfo input { margin: 5px 0; padding: 5px; }
  </style>
</head>
<body>

  <h1>üè• My Gynae Hospital</h1>
  <p style="text-align:center;">123 Medical Street, City | Phone: 123-4567890</p>

  <!-- Patient Info -->
  <div id="patientInfo">
    <label><strong>Patient Name:</strong></label>
    <input type="text" id="patientName" placeholder="Enter patient name"><br>
    <label><strong>Age:</strong></label>
    <input type="number" id="patientAge" placeholder="Enter age" style="width:80px;"><br>
    <label><strong>Doctor / Referred By:</strong></label>
    <input type="text" id="doctorName" placeholder="Enter doctor's name" style="width:250px;">
  </div>

  <!-- Search -->
  <input type="text" id="search" placeholder="Search tests or prices..." style="width:100%; padding:8px; margin:15px 0;">

  <!-- Test Categories -->
  <div id="tests">
    <!-- Biochemistry -->
    <div class="category" data-category="Biochemistry">
      <h2>Biochemistry</h2>
      <div class="test"><label><input type="checkbox" data-price="800"> HBA1C</label><span>Rs. 800</span></div>
      <div class="test"><label><input type="checkbox" data-price="600"> CALCIUM</label><span>Rs. 600</span></div>
      <div class="test"><label><input type="checkbox" data-price="500"> HB%</label><span>Rs. 500</span></div>
      <div class="test"><label><input type="checkbox" data-price="700"> RFTs</label><span>Rs. 700</span></div>
      <div class="test"><label><input type="checkbox" data-price="1200"> LIPID PROFILE</label><span>Rs. 1200</span></div>
      <div class="test"><label><input type="checkbox" data-price="900"> S ELECTROLYTES</label><span>Rs. 900</span></div>
      <div class="test"><label><input type="checkbox" data-price="750"> S AMYLASE</label><span>Rs. 750</span></div>
      <div class="test"><label><input type="checkbox" data-price="650"> CHOLESTEROL</label><span>Rs. 650</span></div>
      <div class="test"><label><input type="checkbox" data-price="550"> URIC ACID</label><span>Rs. 550</span></div>
      <div class="test"><label><input type="checkbox" data-price="500"> BSR</label><span>Rs. 500</span></div>
      <div class="test"><label><input type="checkbox" data-price="1000"> LFT</label><span>Rs. 1000</span></div>
      <div class="test"><label><input type="checkbox" data-price="950"> T3 T4 TSH</label><span>Rs. 950</span></div>
      <div class="test"><label><input type="checkbox" data-price="400"> TSH</label><span>Rs. 400</span></div>
      <div class="test"><label><input type="checkbox" data-price="850"> VIT.D3</label><span>Rs. 850</span></div>
      <div class="test"><label><input type="checkbox" data-price="750"> VIT.B12</label><span>Rs. 750</span></div>
    </div>

    <!-- Serology & Infectious Diseases -->
    <div class="category" data-category="Serology">
      <h2>Serology & Infectious Diseases</h2>
      <div class="test"><label><input type="checkbox" data-price="650"> IGE</label><span>Rs. 650</span></div>
      <div class="test"><label><input type="checkbox" data-price="900"> HCV ELIZA</label><span>Rs. 900</span></div>
      <div class="test"><label><input type="checkbox" data-price="950"> HBS ALIZA</label><span>Rs. 950</span></div>
      <div class="test"><label><input type="checkbox" data-price="1500"> HCV PCR(QL)</label><span>Rs. 1500</span></div>
      <div class="test"><label><input type="checkbox" data-price="1600"> HBV PCR (QN)</label><span>Rs. 1600</span></div>
      <div class="test"><label><input type="checkbox" data-price="850"> HIV</label><span>Rs. 850</span></div>
      <div class="test"><label><input type="checkbox" data-price="700"> TYPHIDOT</label><span>Rs. 700</span></div>
      <div class="test"><label><input type="checkbox" data-price="500"> WIDAL</label><span>Rs. 500</span></div>
      <div class="test"><label><input type="checkbox" data-price="550"> H.PYLORI</label><span>Rs. 550</span></div>
      <div class="test"><label><input type="checkbox" data-price="800"> RA FACTOR</label><span>Rs. 800</span></div>
      <div class="test"><label><input type="checkbox" data-price="700"> CRP</label><span>Rs. 700</span></div>
      <div class="test"><label><input type="checkbox" data-price="950"> ANTI HCV</label><span>Rs. 950</span></div>
      <div class="test"><label><input type="checkbox" data-price="1000"> HB & AG</label><span>Rs. 1000</span></div>
      <div class="test"><label><input type="checkbox" data-price="600"> VDRL</label><span>Rs. 600</span></div>
      <div class="test"><label><input type="checkbox" data-price="500"> ESR</label><span>Rs. 500</span></div>
      <div class="test"><label><input type="checkbox" data-price="750"> MALARIA</label><span>Rs. 750</span></div>
      <div class="test"><label><input type="checkbox" data-price="800"> DENGUE</label><span>Rs. 800</span></div>
      <div class="test"><label><input type="checkbox" data-price="500"> CROSS MATCH</label><span>Rs. 500</span></div>
    </div>

    <!-- Hormones -->
    <div class="category" data-category="Hormones">
      <h2>Hormones</h2>
      <div class="test"><label><input type="checkbox" data-price="700"> FSH</label><span>Rs. 700</span></div>
      <div class="test"><label><input type="checkbox" data-price="750"> LH</label><span>Rs. 750</span></div>
      <div class="test"><label><input type="checkbox" data-price="800"> PROLACTIN</label><span>Rs. 800</span></div>
      <div class="test"><label><input type="checkbox" data-price="950"> TESTOSTERONE</label><span>Rs. 950</span></div>
      <div class="test"><label><input type="checkbox" data-price="1000"> PROGESTERONE</label><span>Rs. 1000</span></div>
      <div class="test"><label><input type="checkbox" data-price="1100"> BETA HCG</label><span>Rs. 1100</span></div>
      <div class="test"><label><input type="checkbox" data-price="850"> B HCG</label><span>Rs. 850</span></div>
      <div class="test"><label><input type="checkbox" data-price="650"> INSOLINE</label><span>Rs. 650</span></div>
    </div>

    <!-- Hematology -->
    <div class="category" data-category="Hematology">
      <h2>Hematology</h2>
      <div class="test"><label><input type="checkbox" data-price="600"> CBC</label><span>Rs. 600</span></div>
      <div class="test"><label><input type="checkbox" data-price="800"> PT</label><span>Rs. 800</span></div>
      <div class="test"><label><input type="checkbox" data-price="750"> APTT</label><span>Rs. 750</span></div>
      <div class="test"><label><input type="checkbox" data-price="850"> INR</label><span>Rs. 850</span></div>
    </div>

    <!-- Microbiology -->
    <div class="category" data-category="Microbiology">
      <h2>Microbiology</h2>
      <div class="test"><label><input type="checkbox" data-price="700"> STOOL R E</label><span>Rs. 700</span></div>
      <div class="test"><label><input type="checkbox" data-price="900"> SEMEN ANALYSIS</label><span>Rs. 900</span></div>
      <div class="test"><label><input type="checkbox" data-price="600"> URINE C E</label><span>Rs. 600</span></div>
      <div class="test"><label><input type="checkbox" data-price="400"> URINE PREGNANCY</label><span>Rs. 400</span></div>
      <div class="test"><label><input type="checkbox" data-price="550"> SPUTUM FOR AFB</label><span>Rs. 550</span></div>
    </div>

    <!-- Radiology -->
    <div class="category" data-category="Radiology">
      <h2>Radiology</h2>
      <div class="test"><label><input type="checkbox" data-price="1500"> DIGITAL X-RAY</label><span>Rs. 1500</span></div>
    </div>
  </div>

  <!-- Selected Tests -->
  <div id="selectedTests">
    <h2>Selected Tests</h2>
    <ul id="testList"></ul>
    <h2 style="color:#d62828; font-size:22px;">Total Amount: Rs. <span id="totalAmount">0</span></h2>
  </div>

  <!-- Controls -->
  <div id="controls">
    <button class="print" onclick="printReceipt()">üñ®Ô∏è Print Receipt</button>
    <button class="pdf" onclick="downloadPDF()">üì• Download PDF</button>
  </div>

<script>
  // Filter tests by name or price
  document.getElementById("search").addEventListener("keyup", function() {
    let filter = this.value.toLowerCase();
    let categories = document.querySelectorAll(".category");
    categories.forEach(cat => {
      let tests = cat.querySelectorAll(".test");
      let anyVisible = false;
      tests.forEach(test => {
        let text = test.innerText.toLowerCase();
        if (text.includes(filter)) {
          test.classList.remove("hidden");
          anyVisible = true;
        } else {
          test.classList.add("hidden");
        }
      });
      cat.querySelector("h2").style.display = anyVisible ? "block" : "none";
    });
  });

  // Track selected tests
  let checkboxes = document.querySelectorAll("input[type=checkbox]");
  let testList = document.getElementById("testList");
  let totalAmount = document.getElementById("totalAmount");

  checkboxes.forEach(cb => {
    cb.addEventListener("change", () => {
      let liId = "li-" + cb.parentElement.innerText.trim();
      if (cb.checked) {
        let li = document.createElement("li");
        li.id = liId;
        li.textContent = cb.parentElement.innerText.trim() + " - Rs. " + cb.getAttribute("data-price");
        testList.appendChild(li);
      } else {
        let li = document.getElementById(liId);
        if (li) li.remove();
      }
      calculateTotal();
    });
  });

  function calculateTotal() {
    let total = 0;
    document.querySelectorAll("#testList li").forEach(li => {
      let price = li.textContent.split("Rs. ")[1];
      total += parseInt(price);
    });
    totalAmount.textContent = total;
  }

  // Invoice number generator
  function getNextInvoiceNumber() {
    let lastNum = localStorage.getItem("lastInvoiceNum");
    if (!lastNum) lastNum = 1000;
    let newNum = parseInt(lastNum) + 1;
    localStorage.setItem("lastInvoiceNum", newNum);
    return "INV-" + newNum;
  }

  // Collect receipt data
  function getReceiptData() {
    let total = document.getElementById("totalAmount").innerText;
    let items = Array.from(document.querySelectorAll("#testList li"))
                     .map(li => li.textContent.trim());
    let name = document.getElementById("patientName").value || "N/A";
    let age = document.getElementById("patientAge").value || "N/A";
    let doctor = document.getElementById("doctorName").value || "N/A";
    return { total, items, name, age, doctor };
  }

  // Print Receipt
  function printReceipt() {
    let { total, items, name, age, doctor } = getReceiptData();
    let today = new Date();
    let dateStr = today.toLocaleDateString() + " " + today.toLocaleTimeString();
    let invoiceNo = getNextInvoiceNumber();

    let receipt = `
    <div style="font-family:Arial; padding:20px; line-height:1.6; position:relative; min-height:100vh;">
      <h1 style="text-align:center; margin:0; color:#005f99; font-size:28px; font-weight:bold;">
        üè• My Gynae Hospital
      </h1>
      <p style="text-align:center; margin:5px 0; font-size:14px;">123 Medical Street, City | Phone: 123-4567890</p>
      <hr style="margin:15px 0;">
      <p><strong>Invoice No:</strong> ${invoiceNo}</p>
      <p><strong>Date:</strong> ${dateStr}</p>
      <p><strong>Patient Name:</strong> ${name}</p>
      <p><strong>Age:</strong> ${age}</p>
      <p><strong>Doctor / Referred By:</strong> ${doctor}</p>
      <h2 style="margin:10px 0; color:#333;">Selected Tests:</h2>
      <ul style="font-size:14px; margin:0 0 15px 20px;">
        ${items.map(i => `<li>${i}</li>`).join("")}
      </ul>
      <h2 style="color:#d62828; font-size:22px; font-weight:bold; text-align:right; margin-right:20px;">
        Total Amount: Rs. ${total}
      </h2>
      
      <!-- Signature footer -->
      <div style="position:absolute; bottom:80px; left:0; width:100%; display:flex; justify-content:space-between; padding:0 40px;">
        <div style="text-align:center;">
          <p>__________________________</p>
          <p style="margin-top:-10px;">Doctor's Signature</p>
        </div>
        <div style="text-align:center;">
          <p>__________________________</p>
          <p style="margin-top:-10px;">Lab Incharge Signature</p>
        </div>
      </div>

      <p style="position:absolute; bottom:30px;